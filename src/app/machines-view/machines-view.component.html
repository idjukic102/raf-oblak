<form class="search-form" [formGroup]="createForm" (ngSubmit)="onSubmit()">
  <div class="row">
    <label for="name">Naziv</label>
    <input id="name" type="text" formControlName="name" placeholder="" />
  </div>

  <div class="row">
    <label for="stanja">Stanje</label>
    <select id="stanja" formControlName="stanja" multiple>
      <option *ngFor="let s of svaStanja" [value]="s">{{ s }}</option>
    </select>
    <small class="hint"></small>
  </div>

  <div class="actions">
    <button
      type="submit"
      class="btn btn-primary"
      [disabled]="createForm.invalid"
    >
      Pretraži
    </button>
    <button type="button" class="btn btn-outline-secondary" (click)="onReset()">
      Poništi
    </button>
  </div>
</form>

<hr />

<table *ngIf="machines?.length; else nemaPodataka" class="results">
  <thead>
    <tr>
      <th>Naziv</th>
      <th>Stanje</th>
      <th>Aktivnost</th>
      <th>Akcije</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let m of machines">
      <td>{{ m.name }}</td>
      <td>{{ m.stanje }}</td>
      <td>{{ m.aktivna }}</td>
      <td class="actions">
        <button type="button" class="btn btn-primary" (click)="openSchedule(m)">
          Zakaži operaciju
        </button>
        <!-- <button (click)="openErrors(m.id)">Istorija grešaka</button> -->
      </td>
    </tr>
  </tbody>
</table>

<ng-template #nemaPodataka>
  <p>Nema podataka za zadate kriterijume.</p>
</ng-template>

<div class="schedule-backdrop" *ngIf="showScheduleModal">
  <div class="schedule-modal">
    <h3>Zakazivanje operacije za {{ selectedMachine?.name }}</h3>

    <form [formGroup]="scheduleForm" (ngSubmit)="submitSchedule()">
      <div class="row">
        <label>Operacija</label>
        <label>
          <input
            type="radio"
            value="START"
            formControlName="operation"
            [attr.disabled]="
              selectedMachine?.stanje !== StanjeMasine.Ugasena ? '' : null
            "
          />
          Start
        </label>
        <label>
          <input
            type="radio"
            value="STOP"
            formControlName="operation"
            [attr.disabled]="
              selectedMachine?.stanje !== StanjeMasine.Upaljena ? '' : null
            "
          />
          Stop
        </label>
        <label>
          <input
            type="radio"
            value="RESTART"
            formControlName="operation"
            [attr.disabled]="
              selectedMachine?.stanje !== StanjeMasine.Upaljena ? '' : null
            "
          />
          Restart
        </label>
      </div>

      <div class="row">
        <label for="schedule-date">Datum</label>
        <input id="schedule-date" type="date" formControlName="date" />
      </div>

      <div class="row">
        <label for="schedule-time">Vreme</label>
        <input id="schedule-time" type="time" formControlName="time" />
      </div>

      <div class="actions">
        <button
          type="button"
          class="btn btn-outline-secondary"
          (click)="closeSchedule()"
        >
          Otkaži
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="scheduleForm.invalid"
        >
          Sačuvaj
        </button>
      </div>
    </form>
  </div>
</div>

<style>
  .search-form {
    display: grid;
    gap: 12px;
    max-width: 560px;
  }
  .row {
    display: grid;
    gap: 6px;
  }
  label {
    font-weight: 600;
  }
  input,
  select {
    padding: 8px;
    font-size: 14px;
  }
  select[multiple] {
    height: 110px;
  }
  .actions {
    display: flex;
    gap: 8px;
  }

  .results {
    border-collapse: collapse;
    margin-top: 16px;
    width: 100%;
  }
  .results th,
  .results td {
    border: 1px solid #e5e5e5;
    padding: 8px;
  }
  .results th {
    text-align: left;
    background: #fafafa;
  }
  .hint {
    font-size: 12px;
    color: #666;
  }

  .schedule-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  .schedule-modal {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    min-width: 380px;
    max-width: 480px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
  }

  .schedule-modal .row {
    margin-bottom: 10px;
  }
</style>
